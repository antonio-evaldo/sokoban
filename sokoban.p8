pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
  win = false

  sprites = {
    wall = 1,
    box = 2,
    goal = 3
  }

  make_player()
  make_boxes()
end

function _update()
  if not win then
    move_player_and_boxes()
    check_win()
  end
end

function _draw()
  cls()
  map()

  draw_player()
  draw_boxes()

  if (win) print('you won!', 50, 10)
end
-->8
function make_player()
  player = {
    x = 7 * 8,
    y = 6 * 8,
    sprite = 16
  }
end

function make_boxes()
  box = {
    x = 8 * 8,
    y = 8 * 8,
    sprite = sprites.box
  }
end

function move_player_and_boxes()
  local move = { x = 0, y = 0 }

  if (btnp(0)) move.x = -8
  if (btnp(1)) move.x = 8
  if (btnp(2)) move.y = -8
  if (btnp(3)) move.y = 8
  local newplayerx = player.x + move.x
  local newplayery = player.y + move.y

  if collinding_wall(newplayerx, newplayery) then return end

  if not collinding_box(newplayerx, newplayery) then
    player.x += move.x
    player.y += move.y
  end

  if collinding_box(newplayerx, newplayery) and not collinding_wall(box.x + move.x, box.y + move.y) then
    player.x += move.x
    player.y += move.y

    box.x += move.x
    box.y += move.y
  end
end

function collinding_wall(x, y)
  return mget_coord(x, y) == sprites.wall
end

function mget_coord(x, y)
  return mget(x / 8, y / 8)
end

function collinding_box(x, y)
  return x == box.x and y == box.y
end

function check_win()
  if mget_coord(box.x, box.y) == sprites.goal then
    win = true
  end
end

function draw_player()
  spr(player.sprite, player.x, player.y)
end

function draw_boxes()
  spr(box.sprite, box.x, box.y)
end
__gfx__
0000000077777777000aa000cccccccc00aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777700aaaa00c000000c0aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770aaaaaa0c000000caaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077777777aaaaaaaac000000caaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077777777aaaaaaaac000000caaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770aaaaaa0c000000caaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777700aaaa00c000000c0aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077777777000aa000cccccccc00aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88088088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11011011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11011011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000001030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000010000101010100000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010101010000000000000000000100000100000001030001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010003010000000000000000000100020100000001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010000000000000000000100000101010101000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010101000000000000000100000000010100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000000001000000000000000101000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000000001000000000000000101000001010101000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010101000000000000000100000001000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010000000000000000000100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010101010000000000000000000101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
