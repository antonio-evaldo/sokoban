pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
  win = false

  sprites = {
    wall = 1,
    box = 2,
    goal = 3,
    player = 16
  }

  level = 3

  make_player()
  make_boxes()
  make_map()
end

function _update()
  if not win then
    move_player_and_boxes()
    check_win()
  end
end

function _draw()
  cls()

  draw_map()
  draw_player()
  draw_boxes()

  if (win) print('you won!', 50, 10)
end
-->8
function make_player()
  player = {
    x = nil,
    y = nil,
    sprite = sprites.player
  }
end

function make_boxes()
  box = {
    x = nil,
    y = nil,
    sprite = sprites.box
  }
end

function move_player_and_boxes()
  local move = { x = 0, y = 0 }

  if (btnp(0)) move.x = -8
  if (btnp(1)) move.x = 8
  if (btnp(2)) move.y = -8
  if (btnp(3)) move.y = 8
  local newplayerx = player.x + move.x
  local newplayery = player.y + move.y

  if collinding_wall(newplayerx, newplayery) then return end

  if not collinding_box(newplayerx, newplayery) then
    player.x += move.x
    player.y += move.y
  end

  if collinding_box(newplayerx, newplayery) and not collinding_wall(box.x + move.x, box.y + move.y) then
    player.x += move.x
    player.y += move.y

    box.x += move.x
    box.y += move.y
  end
end

function collinding_wall(x, y)
  return mget_coord(x, y) == sprites.wall
end

function collinding_box(x, y)
  return x == box.x and y == box.y
end

function check_win()
  if mget_coord(box.x, box.y) == sprites.goal then
    win = true
  end
end

function draw_player()
  spr(player.sprite, player.x, player.y)
end

function draw_boxes()
  spr(box.sprite, box.x, box.y)
end
-->8
function make_map()
  for x = 0, 15 do
    for y = 0, 15 do
      if mget_in_level(x, y) == player.sprite then
        player.x = x * 8
        player.y = y * 8
        mset_in_level(x, y, 0) -- remove player from static map
      elseif mget_in_level(x, y) == box.sprite then
        box.x = x * 8
        box.y = y * 8
        mset_in_level(x, y, 0) -- remove box from static map
      end
    end
  end
end

function mget_coord(x, y)
  return mget_in_level(x / 8, y / 8)
end

function mget_in_level(x, y)
  return mget(x + (level - 1) * 16, y)
end

function mset_in_level(x, y)
  return mset(x + (level - 1) * 16, y)
end

function draw_map()
  local map_tx = (level - 1) * 16
  map(map_tx, 0)
end
__gfx__
0000000077777777000aa000cccccccc0cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777700aaaa00c000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770aaaaaa0c000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077777777aaaaaaaac000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077777777aaaaaaaac000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770aaaaaa0c000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007777777700aaaa00c000000ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077777777000aa000cccccccc0cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88088088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11011011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11011011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99099909099909990999099900099000999009990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90090909090909090909090900090900090009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90099009099909900999090900090900090009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99090909090909090900090900090900090009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000900099900090900090009990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000400000000000000000000000000000101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000400000000000000000000000000000100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010101010000000000000000000040410000000000000400000000000001010101010101010100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010003010000000000000000000000000000430000000400000000000001000001000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010000000000000000000000000000420000000400000000000001000201030000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010010010101000000000000000010000000440000000400000000000001000001010101010101000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000000001000000000000000000000000000000000400000000000001000000000000010101000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000020001000000000000000000000000000000000400000000000001010000000000000001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010101000000000000000000000000000000000400000000000001010000010100010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000010000000000000000000000000000000000000400000000000001001000010000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010101010000000000000000000000000000000000000400000000000001000000010000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000400000000000001010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
